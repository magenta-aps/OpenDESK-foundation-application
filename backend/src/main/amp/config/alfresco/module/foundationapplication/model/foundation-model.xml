<?xml version="1.0" encoding="UTF-8"?>
<model name="odf:openDeskFoundationModel" xmlns="http://www.alfresco.org/model/dictionary/1.0">

    <!-- Optional meta-data about the model -->
    <description>Document Model for OpenDesk Foundation Extensions</description>
    <author>Magenta ApS</author>
    <version>1.0</version>

    <imports>
        <!-- Import Alfresco Dictionary Definitions -->
        <import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d"/>
        <!-- Import Alfresco Content Domain Model Definitions -->
        <import uri="http://www.alfresco.org/model/content/1.0" prefix="cm"/>
        <!-- Import Alfresco System Model Definitions -->
        <import uri="http://www.alfresco.org/model/system/1.0" prefix="sys"/>
        <!-- Import Alfresco Forum Model Definitions -->
        <import uri="http://www.alfresco.org/model/forum/1.0" prefix="fm"/>
    </imports>

    <!-- Custom namespace for your domain -->
    <namespaces>
        <namespace uri="http://www.magenta-aps.dk/model/foundation/${project.version}" prefix="odf"/>
    </namespaces>

    <!-- ===============================================================================================================
        Constraints, Types, and Aspects go here...
        -->
        
    <constraints>
        <!--        <constraint name='test:regex1' type='REGEX'>
            <parameter name='expression'>
                <value>[A-Z]*</value>
            </parameter>
            <parameter name='requiresMatch'>
                <value>false</value>
            </parameter>
        </constraint>-->
        <constraint name='odf:cvr' type='REGEX'>
            <parameter name='expression'>
                <value>[0-9]{8}</value>
            </parameter>
        </constraint>
        <constraint name='odf:postalCode' type='REGEX'>
            <parameter name='expression'>
                <value>[0-9]{4}</value>
            </parameter>
        </constraint>
        <constraint name='odf:shortDescription' type='LENGTH'>
            <parameter name='minLength'>
                <value>0</value>
            </parameter>
            <parameter name='maxLength'>
                <value>1000</value>
            </parameter>
        </constraint>
        <constraint name='odf:email' type="dk.opendesk.foundationapplication.constraints.UnicodeRegexConstraint">
            <parameter name='expression'>
                <value><![CDATA[^[\w0-9.!#$%&â€™*+\=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$]]></value>
            </parameter>
        </constraint>
        <constraint name='odf:phoneNumber' type='REGEX'>
            <parameter name='expression'>
                <value>^\+(?:[0-9] ?){6,14}[0-9]$</value>
            </parameter>
        </constraint>
        
        <!--        <constraint name='test:numberValue' type='MINMAX'>
            <parameter name='minValue'>
                <value>8</value>
            </parameter>
            <parameter name='maxValue'>
                <value>8</value>
            </parameter>
        </constraint>-->
        <constraint name="odf:categories" type="dk.opendesk.foundationapplication.constraints.CategoryConstraint">
            <parameter name="allowedValues">
                <list></list>
            </parameter>
        </constraint>
        <!--        <constraint name='odf:categories' type='LIST'>
            <parameter name='allowedValues'>
                <list>
                    <value>CATEGORY1</value>
                    <value>CATEGORY2</value>
                </list>
            </parameter>
            <parameter name='caseSensitive'>
                <value>true</value>
            </parameter>
        </constraint>-->
    </constraints>        
                    
    <types>
        
        
        <type name="odf:useCondition">
            <title>Terms and Conditions</title>
            <parent>cm:content</parent>
            
        </type>
           
        <type name="odf:termsAndConditions">
            <title>Terms and Conditions</title>
            <parent>cm:cmobject</parent>
            <associations>
                <child-association name="odf:useConditions">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>odf:useCondition</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                    <duplicate>false</duplicate>
                    <propagateTimestamps>true</propagateTimestamps>
                </child-association>
            </associations>      
        </type>
        
        <type name="odf:activeTermsAndConditions">
            <title>Active Terms and Conditions</title>
            <parent>cm:cmobject</parent>
            <associations>
                <association name="odf:activeUseCondition">
                    <title>Active Condition</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>odf:useCondition</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>       
         </type>
         
        <type name="odf:data">
            <title>Foundation Application Data</title>
            <parent>cm:cmobject</parent>
            <associations>
                 <child-association name="odf:workflows">
                     <source>
                         <mandatory>false</mandatory>
                         <many>true</many>
                     </source>
                     <target>
                         <class>odf:applicationWorkflow</class>
                         <mandatory>true</mandatory>
                         <many>false</many>
                     </target>
                     <duplicate>false</duplicate>
                 </child-association>
                 <child-association name="odf:branches">
                     <source>
                         <mandatory>false</mandatory>
                         <many>true</many>
                     </source>
                     <target>
                         <class>odf:applicationBranch</class>
                         <mandatory>true</mandatory>
                         <many>false</many>
                     </target>
                     <duplicate>false</duplicate>
                 </child-association>
                 <child-association name="odf:budgets">
                     <source>
                         <mandatory>false</mandatory>
                         <many>true</many>
                     </source>
                     <target>
                         <class>odf:applicationBudget</class>
                         <mandatory>true</mandatory>
                         <many>false</many>
                     </target>
                     <duplicate>false</duplicate>
                 </child-association>
                 <child-association name="odf:applications">
                     <source>
                         <mandatory>false</mandatory>
                         <many>true</many>
                     </source>
                     <target>
                         <class>odf:application</class>
                         <mandatory>true</mandatory>
                         <many>false</many>
                     </target>
                     <duplicate>true</duplicate>
                 </child-association>
             </associations>
        </type> 
         <type name="odf:applicationWorkflow">
             <title>Application State</title>
             <parent>cm:cmobject</parent>
             <properties>
                 <property name="odf:workflowTitle">
                     <type>d:text</type>
                     <mandatory>true</mandatory>
                 </property>
             </properties>
             <associations>
                 <child-association name="odf:workflowStates">
                     <source>
                         <mandatory>false</mandatory>
                         <many>true</many>
                     </source>
                     <target>
                         <class>odf:applicationState</class>
                         <mandatory>true</mandatory>
                         <many>false</many>
                     </target>
                     <duplicate>false</duplicate>
                 </child-association>
             </associations>       
         </type>
        
        <type name="odf:applicationState">
            <title>Application State</title>
            <parent>cm:cmobject</parent>
            <properties>
                <property name="odf:stateTitle">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
            <associations>
<!--                <child-association name="odf:applications">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>odf:application</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                    <duplicate>false</duplicate>
                </child-association>-->
                <association name="odf:workflowTransitions">
                    <title>Workflow steps</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>odf:applicationState</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>           
        </type>
        
        <type name="odf:applicationBudget">
            <title>Application State</title>
            <parent>cm:content</parent>
            <properties>
                <property name="odf:budgetTitle">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="odf:budgetAmountAvailable">
                    <type>d:long</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>
        
        <type name="odf:applicationBranch">
            <title>Branch</title>
            <parent>cm:cmobject</parent>
            <properties>
                <property name="odf:branchTitle">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
            <associations> 
                <association name="odf:branchWorkflow">
                    <title>Branch Workflow</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>odf:applicationWorkflow</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
                <association name="odf:branchBudgets">
                    <title>Branch Budgets</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>odf:applicationBudget</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>  
        </type>
        
        <type name="odf:application">
            <title>Application</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="odf:applicationTitle">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="odf:applicationCategory">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref='odf:categories'/>
                    </constraints>
                </property>
                <property name="odf:applicationRecipient">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                
                <property name="odf:applicationAddressRoad">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="odf:applicationAddressNumber">
                    <type>d:int</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="odf:applicationAddressFloor">
                    <type>d:int</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="odf:applicationAddressPostalCode">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref='odf:postalCode'/>
                    </constraints>
                </property>
                
                <property name="odf:AapplicationContactPersonName">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="odf:applicationContactPersonSurname">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="odf:applicationContactEmail">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref='odf:email'/>
                    </constraints>
                </property>
                <property name="odf:applicationContactPhoneNumber">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref='odf:phoneNumber'/>
                    </constraints>
                </property>
                <property name="odf:applicationShortDescription">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref='odf:shortDescription'/>
                    </constraints>
                </property>
                
                <property name="odf:applicationProjectStartDate">
                    <type>d:datetime</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="odf:applicationProjectEndDate">
                    <type>d:datetime</type>
                    <mandatory>true</mandatory>
                </property>
                
                <property name="odf:applicationAppliedAmount">
                    <type>d:long</type>
                    <mandatory>true</mandatory>
                </property>
                
                <property name="odf:applicationAccountRegistration">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint type='REGEX'>
                            <parameter name='expression'>
                                <value>[0-9]{0,4}</value>
                            </parameter>
                        </constraint>
                    </constraints>
                    
                </property>
                <property name="odf:applicationAccountNumber">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint type='REGEX'>
                            <parameter name='expression'>
                                <value>[0-9]{0,8}</value>
                            </parameter>
                        </constraint>
                    </constraints>
                </property>

            </properties>
            <associations>
                <association name="odf:applicationBudget">
                    <title>Application Budget</title>
                    <source>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>odf:applicationBudget</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
                <association name="odf:applicationBranch">
                    <title>Application Budget</title>
                    <source>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>odf:applicationBranch</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
                <association name="odf:applicationState">
                    <title>Application Budget</title>
                    <source>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>odf:applicationState</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations> 
        </type>

    </types>

<!--    <aspects>
        <aspect name="od:notifications">
            <title>Notifications related to a specific user</title>
                <properties>
                    <property name="od:test">
                        <title>test</title>
                        <type>d:text</type>
                    </property>
                </properties>

            <associations>
                <child-association name="od:ids">
                    <target>
                        <class>od:notification</class>
                        <many>true</many>
                    </target>
                </child-association>
            </associations>
        </aspect>

  
    </aspects>-->

    

</model>
